<html><head><title>weForth v4.2</title><style>h2{color:#c44;margin:0}h3{color:#fc4;margin:0}.base{display:flex;font-size:18px;font-family:monospace;width:100%;height:100%}.side{display:flex;flex-direction:column;width:220px;height:100%}.tic{width:100%;text-align:center;background-color:#eee;margin:2px;padding:5px 0 5px 0}.tac{text-align:right;color:#484;margin:4px;padding-right:6px}.edt{height:100%;display:flex;flex-direction:row}.txt{height:100%;margin:4px;display:flex;flex-direction:column;overflow-x:scroll;display:block}.sep{width:3px;height:100%;border:0;cursor:col-resize}.cmd{color:#48f;margin:2px}.CodeMirror{width:100%;border:1px solid #444;height:auto;font-size:.8em}</style><link href=https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/forth/forth.min.js></script></head><body><div class=base><div class=side><pre class=tic>Data Stack</pre><pre class=tac id=ss></pre><pre class=tic>User Dict</pre><pre class=tac id=dc></pre></div><div class=edt style=width:85%><pre class=txt id=txt style=width:60%></pre><div class=sep id=sep></div><div class=txt id=edt style=width:40%><div style=display:flex><input id=tib onkeyup='"Enter"==event.key&&forth_eval()'style=width:100%;font-size:1em value=""></div><textarea id=cm>
\ 1. find tests/lesson410.txt, drag & drop it into this area
\ 2. high-light each example using arrow-keys with SHIFT-key down
\ 3. hit Ctrl-C to cut & paste into input line above
\ 4. hit RETURN to execute</textarea></div></div></div><script>let tib=document.getElementById("tib"),txt=document.getElementById("txt"),edt=document.getElementById("edt"),cm=CodeMirror.fromTextArea(document.getElementById("cm"),{lineNumbers:!0,styleActiveLine:!0,mode:"forth"});function drag(t,e,o){e.onmousedown=n=>{let r={mx:n.clientX,my:n.clientY,x:n.offsetLeft,y:n.offsetTop,w0:t.offsetWidth,w1:o.offsetWidth};document.onmousemove=n=>{let i={x:n.clientX-r.mx,y:n.clientY-r.my};i.x=Math.min(Math.max(i.x,-r.w0),r.w1),e.style.left=r.offsetLeft+i.x+"px",t.style.width=r.w0+i.x+"px",o.style.width=r.w1-i.x+"px"},document.onmouseup=()=>{document.onmousemove=document.onmouseup=null}}}function show_ss(){const t=t=>Number.isInteger(t)?t.toString(o):Math.round(1e5*t)/1e5,e=wasmExports,o=e.vm_base(),n=(t,n)=>e.vm_dflt()?new Float32Array(e.memory.buffer,t,n):10==o?new Int32Array(e.memory.buffer,t,n):new Uint32Array(e.memory.buffer,t,n),r=e.vm_ss_idx()>0?e.vm_ss_idx():0,i=n(e.vm_ss(),r),s=n(e.tos,1);let m=document.getElementById("ss");m.innerHTML=t(s[0])+"<br/>";for(let e=r-1;e>=0;--e)m.innerHTML+=t(i[e])+"<br/>"}function show_dict(){let t=wasmExports.vm_dict_idx(),e=Module.cwrap("vm_dict","string",["number"]),o=document.getElementById("dc");o.innerHTML="";for(var n=t-1;n>=0&&"boot"!=e(n);--n)o.innerHTML+=e(n)+"<br/>"}function to_txt(t,e=!0){txt.innerHTML+=e?t+"<br/>":t,txt.scrollTop=txt.scrollHeight}cm.setSize("100%","100%"),cm.on("copy",(t=>{let e=t.getSelection();tib.value=e.replace(/[\t|\n]/g," "),tib.style.backgroundColor="#fe0",document.activeElement.blur(),tib.focus()})),drag(txt,document.getElementById("sep"),edt);var Module={print:to_txt};const ex=t=>Function(`"use strict"; this.eval(${t})`).bind(this)();function forth_eval(){const t=()=>{tib.value="",tib.focus(),tib.style.backgroundColor="white"};let e=tib.value.replace(/:/g,"<br/>:");if("clear"==e)return txt.innerHTML="",void t();0==e.indexOf("<br/>")&&e.replace("<br/>",""),to_txt('<pre class="cmd"><em>'+e+"</em></pre>",!1);try{for(var o=Module.cwrap("forth","int",["number","string"]);o(0,tib.value););show_ss(),show_dict()}catch(t){console.log(t.toString()+"\n")}finally{t()}}this.onmessage=t=>{console.log(t.data),"js"==t.data[0]&&ex(t.data[1][1])}</script><script src=ceforth.js async></script></body></html>